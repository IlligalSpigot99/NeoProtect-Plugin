package de.illigalspigot.neoprotect.vulnerability;

import java.io.OutputStreamWriter;
import java.net.HttpURLConnection;
import java.net.URL;
import java.util.HashMap;

import com.google.gson.Gson;

import de.illigalspigot.neoprotect.filemanagement.FileManagement;

public class Vulnerability {
	
	public static void addVulnerability(Type type, FileManagement fileManagement) {
		try {
			String text = "https://api.neoprotect.net/v1/vulnerabilities/" + fileManagement.getServerID();
			URL url = new URL(text);
			HttpURLConnection conn = (HttpURLConnection) url.openConnection();
			conn.setRequestProperty("User-Agent", "Mozilla/5.0 (Windows; U; Windows NT 6.1; en-GB;     rv:1.9.2.13) Gecko/20101203 Firefox/3.6.13 (.NET CLR 3.5.30729)");
			conn.setRequestProperty("Authorization", "Bearer " + fileManagement.getAPIKey());
			conn.setRequestProperty("content-type", "application/json");
			conn.setRequestMethod("POST");
			conn.setUseCaches(false);
			conn.setDoInput(true);
			conn.setDoOutput(true);
			OutputStreamWriter osw = new OutputStreamWriter(conn.getOutputStream(), "UTF-8");
			HashMap<String, Object> vulnerability = new HashMap<>();
			switch(type) {
				case DIRECT_IP:
					vulnerability.put("description", "A player try to join directly to the original ip of you server.");
					vulnerability.put("type", type);
					break;
				case DIRECT_ATTACK:
					vulnerability.put("description", "Someone tried to attack your server directly to the real server ip.");
					vulnerability.put("type", type);
					break;
				case CRACKED:
					vulnerability.put("description", "Your Server is cracked. Bots, who not filtered, can damage your server.");
					vulnerability.put("type", type);
					break;
				default:
					vulnerability.put("description", "Error_404: Description not found.");
					vulnerability.put("type", type);
					break;
			}
			Gson gson = new Gson();
			osw.write(gson.toJson(vulnerability));
			osw.flush();
			osw.close();
			conn.getResponseCode();
			conn.disconnect();
			
		} catch (Exception e) {
			e.printStackTrace();
		}
	}

}
